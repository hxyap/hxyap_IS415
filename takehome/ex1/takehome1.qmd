---
title: "Takehome 1"
author: "Yap Hong Xian"
date: "September 02, 2024"
date-modified: "September 02, 2024"
execute: 
  eval: true
  echo: true
  freeze: true
format:
  html:
    toc: true
    code-fold: true
---

```{r}
install.packages("maptools", repos = "https://packagemanager.posit.co/cran/2023-10-13")
```

```{r}
pacman::p_load(tmap, sf, tidyverse, raster, spatstat, maptools, sp, sparr)
```

# Introduction: Armed Conflict in Myanmar

Myanmar, formerly known as Burma, is a country in Southeast Asia with a rich cultural heritage and a complex, often troubled modern history. With a population of about 54 million people and over 135 distinct ethnic groups, Myanmar is a tapestry of diverse cultures, languages, and traditions. However, this diversity has also been a source of long-standing tensions and conflicts.

## Historical Context

Since gaining independence from British rule in 1948, Myanmar has grappled with numerous internal conflicts. For decades, the country was under military rule, which ended officially in 2011 with a transition to a quasi-civilian government. However, in February 2021, the military (Tatmadaw) seized power again in a coup, plunging the country back into political turmoil and reigniting many dormant conflicts.

## Key Factors in Myanmar's Conflicts

Our analysis of armed conflict in Myanmar focuses on three primary factors that have historically been, and continue to be, major drivers of instability:

1\. **Religious Tensions**: Myanmar is predominantly Buddhist, but with significant Muslim, Christian, and animist minorities. Religious tensions, particularly between Buddhists and Muslims, have led to violent conflicts, most notably the persecution of the Rohingya Muslim minority in Rakhine State.

2\. **Ethnic Tensions**: The country's ethnic diversity has been a source of both cultural richness and conflict. Many ethnic minority groups, particularly in border areas, have long sought greater autonomy or independence from the central government dominated by the Bamar majority. These tensions have resulted in some of the world's longest-running civil wars.

3\. **Drug Trade and Infrastructure Development**: Myanmar is part of the Golden Triangle, one of the world's largest drug-producing regions. The drug trade, particularly methamphetamine and opium, has fueled conflicts and corrupted institutions. Simultaneously, infrastructure development projects, often involving foreign investment, have sometimes exacerbated local tensions over land rights and resource allocation.

## Purpose of the Analysis Given this complex backdrop, our geospatial analysis of armed conflict in Myanmar aims to:

1\. Identify patterns and hotspots of conflict related to religious and ethnic tensions.

2\. Examine how these factors interact and potentially exacerbate each other in different regions of the country.

3\. Track changes in conflict patterns over time, particularly in relation to significant political events like the 2021 military coup.

By focusing on these aspects, we hope to provide valuable insights that can inform humanitarian responses, contribute to a better understanding of conflict dynamics, and assist in developing more effective strategies for peace-building and development in the region.

```{r}
acled_sf <- read_csv("data/ACLED_Myanmar.csv") %>%
  st_as_sf(coords = c("longitude", "latitude"),
           crs = 4326) %>%
  st_transform(crs = 32647) %>%
  mutate(event_date = dmy(event_date))
```

```{r}
tmap_mode("plot")
acled_sf %>%
  filter(year == 2023 |
           event_type == "Political violence") %>%
  tm_shape() +
  tm_dots()
```

```{r}
glimpse(acled_sf)
```

```{r}
# Filter the data for the specified date range
acled_filtered <- acled_sf %>%
  filter(event_date >= as.Date("2021-01-01") & event_date <= as.Date("2024-06-30"))
```

```{r}
distinct_actor1 <- acled_filtered %>% 
  st_drop_geometry() %>%
  distinct(actor1) %>%
  filter(!is.na(actor1))
print(distinct_actor1)
```

```{r}
distinct_actor2 <- acled_filtered %>% 
  st_drop_geometry() %>%
  distinct(actor2) %>%
  filter(!is.na(actor2))
print(distinct_actor2)
```

```{r}
myanmar_boundary_sf <- st_read(dsn = "data/mmr_polbnda_adm0_250k_mimu_1", 
                layer = "mmr_polbnda_adm0_250k_mimu_1")
```

# Compare CRS

Since we've gotten our data from different sources, let's find out if they follow Myanmar's crs system WGS84 to ensure consistency for our analysis!

```{r}
# Check CRS of acled_sf
print("CRS of ACLED data:")
print(st_crs(acled_sf))
```

```{r}
# Transform Myanmar boundary to match ACLED data CRS
myanmar_boundary_sf <- st_transform(myanmar_boundary_sf, st_crs(acled_sf))
# Unite all geometries
myanmar_boundary_sf <- st_union(myanmar_boundary_sf)

# Remove Z or M dimensions
myanmar_boundary_sf <- st_zm(myanmar_boundary_sf, drop = TRUE, what = "ZM")

print(st_crs(myanmar_boundary_sf))
```

```{r}
# Create a simple plot of the Myanmar boundary
tm_shape(myanmar_boundary_sf) +
  tm_borders(col = "blue", lwd = 2) +
  tm_fill(col = "lightblue", alpha = 0.5) +
  tm_layout(title = "Myanmar Boundary",
            title.size = 1.2,
            title.position = c("center", "top"))
```

Let's check if our event types exist as defined:

Here we check for unique events:

```{r}
unique_event_types <- unique(acled_sf$event_type)
print("Unique event types in the dataset:")
print(unique_event_types)
```

Sweet! looks good! Let's filter out now for our wanted event types!

```{r}

# Filter ACLED data for the specified date range and event types
event_types <- c("Battles", "Explosions/Remote violence", "Strategic developments", "Violence against civilians")
acled_filtered <- acled_sf %>%
  filter(event_date >= as.Date("2021-01-01") & event_date <= as.Date("2024-06-30"),
         event_type %in% event_types) %>%
  mutate(quarter = paste0(year(event_date), "_Q", quarter(event_date)))
```

# Defining our KDE function, and ppp

```{r}
# Create window for ppp objects
myanmar_window <- as.owin(myanmar_boundary_sf)
```

```{r}
# Create the Quarter column
acled_filtered$Quarter <- paste0(year(acled_filtered$event_date), "_Q", quarter(acled_filtered$event_date))
#numeric (1-12)
acled_filtered$QuarterNumeric <- (year(acled_filtered$event_date) - 2021) * 4 + quarter(acled_filtered$event_date)

# Create a new sf object with only Quarter and geometry
acled_quarter <- st_sf(
  QuarterNumeric = acled_filtered$QuarterNumeric,
  geometry = st_geometry(acled_filtered)
)

# Check the result
print(acled_quarter)
```

```{r}
acled_quarter_ppp <- as.ppp(acled_quarter)
```

```{r}
# Apply jittering
acled_q_ppp_jit <- rjitter(acled_quarter_ppp, retry=TRUE, nsim=1, drop=TRUE)

```

```{r}
if (any(duplicated(acled_q_ppp_jit))) {
  warning("Some duplicates remain after jittering")
}
```

```{r}
armed_q_owin <- acled_q_ppp_jit[myanmar_window]
summary(armed_q_owin)
```

## Plotting Armed events owin:

```{r}
plot(armed_q_owin)
```

### Plotting stkde for quarterly kde

```{r}
st_kde <- spattemp.density(armed_q_owin)
summary(st_kde)
```

::: callout-note
In my initial run, there were duplicate points. Since ACLED collects from a variety of sources, I have considered the possibilkity of multiple sources reporting the same event, but for sake of time I have jittered them earlier on. Below, we shall embark on plotting out the graph. Note that I decided on representation as 1-12 since tt only takes in numeric so quarter() from tidyverse would not work well with it...
:::

```{r}
# Function to plot 3 quarters
plot_quarters <- function(start_quarter) {
  quarters <- start_quarter:(start_quarter + 2)
  par(mfrow=c(1,3), mar=c(2,2,2,1))
  
  for(i in quarters) {
    plot(st_kde, i, 
         override.par=FALSE, 
         fix.range=TRUE, 
         main=paste("KDE Q", i, "(", floor((i-1)/4 + 2021), "Q", (i-1)%% 4 + 1, ")"),
         ribbon=TRUE)  # Turned ribbon back on for more informative plots
  }
  
  par(mfrow=c(1,1))  # Reset plot layout
}
```

```{r}
# Plot four sets of quarters
plot_quarters(1)  # Quarters 1, 2, 3
```

```{r}
plot_quarters(4)  # Quarters 4, 5, 6
```

```{r}
plot_quarters(7)  # Quarters 7, 8, 9
```

```{r}
plot_quarters(10)  # Quarters 10, 11, 12
```
